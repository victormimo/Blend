{"ast":null,"code":"'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar _require = require('@twilio/webrtc/lib/util'),\n    guessBrowser = _require.guessBrowser;\n\nvar _require2 = require('@twilio/webrtc'),\n    MediaStream = _require2.MediaStream;\n\nvar _require3 = require('../../util'),\n    waitForEvent = _require3.waitForEvent,\n    waitForSometime = _require3.waitForSometime;\n\nvar localMediaRestartDeferreds = require('../../util/localmediarestartdeferreds');\n\nvar Track = require('./');\n/**\n * A {@link MediaTrack} represents audio or video that can be sent to or\n * received from a {@link Room}.\n * @extends Track\n * @property {Track.ID} id - This {@link Track}'s ID\n * @property {boolean} isStarted - Whether or not the {@link MediaTrack} has\n *   started\n * @property {boolean} isEnabled - Whether or not the {@link MediaTrack} is\n *   enabled (i.e., whether it is paused or muted)\n * @property {Track.Kind} kind - The kind of the underlying\n *   MediaStreamTrack, \"audio\" or \"video\"\n * @property {MediaStreamTrack} mediaStreamTrack - The underlying\n *   MediaStreamTrack\n * @emits MediaTrack#disabled\n * @emits MediaTrack#enabled\n * @emits MediaTrack#started\n */\n\n\nvar MediaTrack = function (_Track) {\n  _inherits(MediaTrack, _Track);\n  /**\n   * Construct a {@link MediaTrack}.\n   * @param {MediaTrackTransceiver} mediaTrackTransceiver\n   * @param {{log: Log}} options\n   */\n\n\n  function MediaTrack(mediaTrackTransceiver, options) {\n    _classCallCheck(this, MediaTrack);\n\n    options = Object.assign({\n      playPausedElementsIfNotBackgrounded: guessBrowser() === 'safari' && (typeof document === 'undefined' ? 'undefined' : _typeof(document)) === 'object' && typeof document.addEventListener === 'function' && typeof document.visibilityState === 'string'\n    }, options);\n\n    var _this = _possibleConstructorReturn(this, (MediaTrack.__proto__ || Object.getPrototypeOf(MediaTrack)).call(this, mediaTrackTransceiver.id, mediaTrackTransceiver.kind, options));\n\n    var isStarted = false;\n    options = Object.assign({\n      MediaStream: MediaStream\n    }, options);\n    /* istanbul ignore next */\n\n    Object.defineProperties(_this, {\n      _attachments: {\n        value: new Set()\n      },\n      _dummyEl: {\n        value: null,\n        writable: true\n      },\n      _elShims: {\n        value: new WeakMap()\n      },\n      _isStarted: {\n        get: function get() {\n          return isStarted;\n        },\n        set: function set(_isStarted) {\n          isStarted = _isStarted;\n        }\n      },\n      _playPausedElementsIfNotBackgrounded: {\n        value: options.playPausedElementsIfNotBackgrounded\n      },\n      _shouldShimAttachedElements: {\n        value: options.workaroundWebKitBug212780 || options.playPausedElementsIfNotBackgrounded\n      },\n      _unprocessedTrack: {\n        value: null,\n        writable: true\n      },\n      _MediaStream: {\n        value: options.MediaStream\n      },\n      isStarted: {\n        enumerable: true,\n        get: function get() {\n          return isStarted;\n        }\n      },\n      mediaStreamTrack: {\n        enumerable: true,\n        get: function get() {\n          return this._unprocessedTrack || mediaTrackTransceiver.track;\n        }\n      },\n      processedTrack: {\n        enumerable: true,\n        value: null,\n        writable: true\n      }\n    });\n\n    _this._initialize();\n\n    return _this;\n  }\n  /**\n   * @private\n   */\n\n\n  _createClass(MediaTrack, [{\n    key: '_start',\n    value: function _start() {\n      this._log.debug('Started');\n\n      this._isStarted = true;\n\n      if (this._dummyEl) {\n        this._dummyEl.oncanplay = null;\n      } // eslint-disable-next-line no-use-before-define\n\n\n      this.emit('started', this);\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_initialize',\n    value: function _initialize() {\n      var self = this;\n\n      this._log.debug('Initializing');\n\n      this._dummyEl = this._createElement();\n      this.mediaStreamTrack.addEventListener('ended', function onended() {\n        self._end();\n\n        self.mediaStreamTrack.removeEventListener('ended', onended);\n      });\n\n      if (this._dummyEl) {\n        this._dummyEl.muted = true;\n        this._dummyEl.oncanplay = this._start.bind(this, this._dummyEl); // NOTE(csantos): We always want to attach the original mediaStreamTrack for dummyEl\n\n        this._attach(this._dummyEl, this.mediaStreamTrack);\n\n        this._attachments.delete(this._dummyEl);\n      }\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_end',\n    value: function _end() {\n      this._log.debug('Ended');\n\n      if (this._dummyEl) {\n        this._detachElement(this._dummyEl);\n\n        this._dummyEl.oncanplay = null;\n      }\n    }\n  }, {\n    key: 'attach',\n    value: function attach(el) {\n      var _this2 = this;\n\n      if (typeof el === 'string') {\n        el = this._selectElement(el);\n      } else if (!el) {\n        el = this._createElement();\n      }\n\n      this._log.debug('Attempting to attach to element:', el);\n\n      el = this._attach(el);\n\n      if (this._shouldShimAttachedElements && !this._elShims.has(el)) {\n        var onUnintentionallyPaused = this._playPausedElementsIfNotBackgrounded ? function () {\n          return playIfPausedAndNotBackgrounded(el, _this2._log);\n        } : null;\n\n        this._elShims.set(el, shimMediaElement(el, onUnintentionallyPaused));\n      }\n\n      return el;\n    }\n    /**\n     * Attach the provided MediaStreamTrack to the media element.\n     * @param el - The media element to attach to\n     * @param mediaStreamTrack - The MediaStreamTrack to attach. If this is\n     * not provided, it uses the processedTrack if it exists\n     * or it defaults to the current mediaStreamTrack\n     * @private\n     */\n\n  }, {\n    key: '_attach',\n    value: function _attach(el) {\n      var mediaStreamTrack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.processedTrack || this.mediaStreamTrack;\n      var mediaStream = el.srcObject;\n\n      if (!(mediaStream instanceof this._MediaStream)) {\n        mediaStream = new this._MediaStream();\n      }\n\n      var getTracks = mediaStreamTrack.kind === 'audio' ? 'getAudioTracks' : 'getVideoTracks';\n      mediaStream[getTracks]().forEach(function (track) {\n        mediaStream.removeTrack(track);\n      });\n      mediaStream.addTrack(mediaStreamTrack); // NOTE(mpatwardhan): resetting `srcObject` here, causes flicker (JSDK-2641), but it lets us\n      // to sidestep the a chrome bug: https://bugs.chromium.org/p/chromium/issues/detail?id=1052353\n      //\n\n      el.srcObject = mediaStream;\n      el.autoplay = true;\n      el.playsInline = true;\n\n      if (!this._attachments.has(el)) {\n        this._attachments.add(el);\n      }\n\n      return el;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_selectElement',\n    value: function _selectElement(selector) {\n      var el = document.querySelector(selector);\n\n      if (!el) {\n        throw new Error('Selector matched no element: ' + selector);\n      }\n\n      return el;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_updateElementsMediaStreamTrack',\n    value: function _updateElementsMediaStreamTrack() {\n      var _this3 = this;\n\n      this._log.debug('Reattaching all elements to update mediaStreamTrack');\n\n      this._getAllAttachedElements().forEach(function (el) {\n        return _this3._attach(el);\n      });\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_createElement',\n    value: function _createElement() {\n      return typeof document !== 'undefined' ? document.createElement(this.kind) : null;\n    }\n  }, {\n    key: 'detach',\n    value: function detach(el) {\n      var els = void 0;\n\n      if (typeof el === 'string') {\n        els = [this._selectElement(el)];\n      } else if (!el) {\n        els = this._getAllAttachedElements();\n      } else {\n        els = [el];\n      }\n\n      this._log.debug('Attempting to detach from elements:', els);\n\n      this._detachElements(els);\n\n      return el ? els[0] : els;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_detachElements',\n    value: function _detachElements(elements) {\n      return elements.map(this._detachElement.bind(this));\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_detachElement',\n    value: function _detachElement(el) {\n      if (!this._attachments.has(el)) {\n        return el;\n      }\n\n      var mediaStream = el.srcObject;\n\n      if (mediaStream instanceof this._MediaStream) {\n        mediaStream.removeTrack(this.processedTrack || this.mediaStreamTrack);\n      }\n\n      this._attachments.delete(el);\n\n      if (this._shouldShimAttachedElements && this._elShims.has(el)) {\n        var shim = this._elShims.get(el);\n\n        shim.unShim();\n\n        this._elShims.delete(el);\n      }\n\n      return el;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_getAllAttachedElements',\n    value: function _getAllAttachedElements() {\n      var els = [];\n\n      this._attachments.forEach(function (el) {\n        els.push(el);\n      });\n\n      return els;\n    }\n  }]);\n\n  return MediaTrack;\n}(Track);\n/**\n * Play an HTMLMediaElement if it is paused and not backgrounded.\n * @private\n * @param {HTMLMediaElement} el\n * @param {Log} log\n * @returns {void}\n */\n\n\nfunction playIfPausedAndNotBackgrounded(el, log) {\n  var tag = el.tagName.toLowerCase();\n  log.warn('Unintentionally paused:', el); // NOTE(mmalavalli): When the element is unintentionally paused, we wait one\n  // second for the \"onvisibilitychange\" event on the HTMLDocument to see if the\n  // app will be backgrounded. If not, then the element can be safely played.\n\n  Promise.race([waitForEvent(document, 'visibilitychange'), waitForSometime(1000)]).then(function () {\n    if (document.visibilityState === 'visible') {\n      // NOTE(mmalavalli): We play the inadvertently paused elements only after\n      // the LocalAudioTrack is unmuted to work around WebKit Bug 213853.\n      //\n      // Bug: https://bugs.webkit.org/show_bug.cgi?id=213853\n      //\n      localMediaRestartDeferreds.whenResolved('audio').then(function () {\n        log.info('Playing unintentionally paused <' + tag + '> element');\n        log.debug('Element:', el);\n        return el.play();\n      }).then(function () {\n        log.info('Successfully played unintentionally paused <' + tag + '> element');\n        log.debug('Element:', el);\n      }).catch(function (error) {\n        log.warn('Error while playing unintentionally paused <' + tag + '> element:', {\n          error: error,\n          el: el\n        });\n      });\n    }\n  });\n}\n/**\n * Shim the pause() and play() methods of the given HTMLMediaElement so that\n * we can detect if it was paused unintentionally.\n * @param {HTMLMediaElement} el\n * @param {?function} [onUnintentionallyPaused=null]\n * @returns {{pausedIntentionally: function, unShim: function}}\n */\n\n\nfunction shimMediaElement(el) {\n  var onUnintentionallyPaused = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var origPause = el.pause;\n  var origPlay = el.play;\n  var _pausedIntentionally = false;\n\n  el.pause = function () {\n    _pausedIntentionally = true;\n    return origPause.call(el);\n  };\n\n  el.play = function () {\n    _pausedIntentionally = false;\n    return origPlay.call(el);\n  };\n\n  var onPause = onUnintentionallyPaused ? function () {\n    if (!_pausedIntentionally) {\n      onUnintentionallyPaused();\n    }\n  } : null;\n\n  if (onPause) {\n    el.addEventListener('pause', onPause);\n  }\n\n  return {\n    pausedIntentionally: function pausedIntentionally() {\n      return _pausedIntentionally;\n    },\n    unShim: function unShim() {\n      el.pause = origPause;\n      el.play = origPlay;\n\n      if (onPause) {\n        el.removeEventListener('pause', onPause);\n      }\n    }\n  };\n}\n\nmodule.exports = MediaTrack;","map":{"version":3,"sources":["/Users/victor/Development/blend/client/node_modules/twilio-video/es5/media/track/mediatrack.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","value","setPrototypeOf","__proto__","_require","require","guessBrowser","_require2","MediaStream","_require3","waitForEvent","waitForSometime","localMediaRestartDeferreds","Track","MediaTrack","_Track","mediaTrackTransceiver","options","assign","playPausedElementsIfNotBackgrounded","document","addEventListener","visibilityState","_this","getPrototypeOf","id","kind","isStarted","_attachments","Set","_dummyEl","_elShims","WeakMap","_isStarted","get","set","_playPausedElementsIfNotBackgrounded","_shouldShimAttachedElements","workaroundWebKitBug212780","_unprocessedTrack","_MediaStream","mediaStreamTrack","track","processedTrack","_initialize","_start","_log","debug","oncanplay","emit","_createElement","onended","_end","removeEventListener","muted","bind","_attach","delete","_detachElement","attach","el","_this2","_selectElement","has","onUnintentionallyPaused","playIfPausedAndNotBackgrounded","shimMediaElement","arguments","undefined","mediaStream","srcObject","getTracks","forEach","removeTrack","addTrack","autoplay","playsInline","add","selector","querySelector","Error","_updateElementsMediaStreamTrack","_this3","_getAllAttachedElements","createElement","detach","els","_detachElements","elements","map","shim","unShim","push","log","tag","tagName","toLowerCase","warn","Promise","race","then","whenResolved","info","play","catch","error","origPause","pause","origPlay","_pausedIntentionally","onPause","pausedIntentionally","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar _require = require('@twilio/webrtc/lib/util'),\n    guessBrowser = _require.guessBrowser;\n\nvar _require2 = require('@twilio/webrtc'),\n    MediaStream = _require2.MediaStream;\n\nvar _require3 = require('../../util'),\n    waitForEvent = _require3.waitForEvent,\n    waitForSometime = _require3.waitForSometime;\n\nvar localMediaRestartDeferreds = require('../../util/localmediarestartdeferreds');\nvar Track = require('./');\n\n/**\n * A {@link MediaTrack} represents audio or video that can be sent to or\n * received from a {@link Room}.\n * @extends Track\n * @property {Track.ID} id - This {@link Track}'s ID\n * @property {boolean} isStarted - Whether or not the {@link MediaTrack} has\n *   started\n * @property {boolean} isEnabled - Whether or not the {@link MediaTrack} is\n *   enabled (i.e., whether it is paused or muted)\n * @property {Track.Kind} kind - The kind of the underlying\n *   MediaStreamTrack, \"audio\" or \"video\"\n * @property {MediaStreamTrack} mediaStreamTrack - The underlying\n *   MediaStreamTrack\n * @emits MediaTrack#disabled\n * @emits MediaTrack#enabled\n * @emits MediaTrack#started\n */\n\nvar MediaTrack = function (_Track) {\n  _inherits(MediaTrack, _Track);\n\n  /**\n   * Construct a {@link MediaTrack}.\n   * @param {MediaTrackTransceiver} mediaTrackTransceiver\n   * @param {{log: Log}} options\n   */\n  function MediaTrack(mediaTrackTransceiver, options) {\n    _classCallCheck(this, MediaTrack);\n\n    options = Object.assign({\n      playPausedElementsIfNotBackgrounded: guessBrowser() === 'safari' && (typeof document === 'undefined' ? 'undefined' : _typeof(document)) === 'object' && typeof document.addEventListener === 'function' && typeof document.visibilityState === 'string'\n    }, options);\n\n    var _this = _possibleConstructorReturn(this, (MediaTrack.__proto__ || Object.getPrototypeOf(MediaTrack)).call(this, mediaTrackTransceiver.id, mediaTrackTransceiver.kind, options));\n\n    var isStarted = false;\n\n    options = Object.assign({\n      MediaStream: MediaStream\n    }, options);\n\n    /* istanbul ignore next */\n    Object.defineProperties(_this, {\n      _attachments: {\n        value: new Set()\n      },\n      _dummyEl: {\n        value: null,\n        writable: true\n      },\n      _elShims: {\n        value: new WeakMap()\n      },\n      _isStarted: {\n        get: function get() {\n          return isStarted;\n        },\n        set: function set(_isStarted) {\n          isStarted = _isStarted;\n        }\n      },\n      _playPausedElementsIfNotBackgrounded: {\n        value: options.playPausedElementsIfNotBackgrounded\n      },\n      _shouldShimAttachedElements: {\n        value: options.workaroundWebKitBug212780 || options.playPausedElementsIfNotBackgrounded\n      },\n      _unprocessedTrack: {\n        value: null,\n        writable: true\n      },\n      _MediaStream: {\n        value: options.MediaStream\n      },\n      isStarted: {\n        enumerable: true,\n        get: function get() {\n          return isStarted;\n        }\n      },\n      mediaStreamTrack: {\n        enumerable: true,\n        get: function get() {\n          return this._unprocessedTrack || mediaTrackTransceiver.track;\n        }\n      },\n      processedTrack: {\n        enumerable: true,\n        value: null,\n        writable: true\n      }\n    });\n\n    _this._initialize();\n    return _this;\n  }\n\n  /**\n   * @private\n   */\n\n\n  _createClass(MediaTrack, [{\n    key: '_start',\n    value: function _start() {\n      this._log.debug('Started');\n      this._isStarted = true;\n      if (this._dummyEl) {\n        this._dummyEl.oncanplay = null;\n      }\n      // eslint-disable-next-line no-use-before-define\n      this.emit('started', this);\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_initialize',\n    value: function _initialize() {\n      var self = this;\n\n      this._log.debug('Initializing');\n      this._dummyEl = this._createElement();\n\n      this.mediaStreamTrack.addEventListener('ended', function onended() {\n        self._end();\n        self.mediaStreamTrack.removeEventListener('ended', onended);\n      });\n\n      if (this._dummyEl) {\n        this._dummyEl.muted = true;\n        this._dummyEl.oncanplay = this._start.bind(this, this._dummyEl);\n\n        // NOTE(csantos): We always want to attach the original mediaStreamTrack for dummyEl\n        this._attach(this._dummyEl, this.mediaStreamTrack);\n\n        this._attachments.delete(this._dummyEl);\n      }\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_end',\n    value: function _end() {\n      this._log.debug('Ended');\n      if (this._dummyEl) {\n        this._detachElement(this._dummyEl);\n        this._dummyEl.oncanplay = null;\n      }\n    }\n  }, {\n    key: 'attach',\n    value: function attach(el) {\n      var _this2 = this;\n\n      if (typeof el === 'string') {\n        el = this._selectElement(el);\n      } else if (!el) {\n        el = this._createElement();\n      }\n      this._log.debug('Attempting to attach to element:', el);\n      el = this._attach(el);\n\n      if (this._shouldShimAttachedElements && !this._elShims.has(el)) {\n        var onUnintentionallyPaused = this._playPausedElementsIfNotBackgrounded ? function () {\n          return playIfPausedAndNotBackgrounded(el, _this2._log);\n        } : null;\n        this._elShims.set(el, shimMediaElement(el, onUnintentionallyPaused));\n      }\n\n      return el;\n    }\n\n    /**\n     * Attach the provided MediaStreamTrack to the media element.\n     * @param el - The media element to attach to\n     * @param mediaStreamTrack - The MediaStreamTrack to attach. If this is\n     * not provided, it uses the processedTrack if it exists\n     * or it defaults to the current mediaStreamTrack\n     * @private\n     */\n\n  }, {\n    key: '_attach',\n    value: function _attach(el) {\n      var mediaStreamTrack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.processedTrack || this.mediaStreamTrack;\n\n      var mediaStream = el.srcObject;\n      if (!(mediaStream instanceof this._MediaStream)) {\n        mediaStream = new this._MediaStream();\n      }\n\n      var getTracks = mediaStreamTrack.kind === 'audio' ? 'getAudioTracks' : 'getVideoTracks';\n\n      mediaStream[getTracks]().forEach(function (track) {\n        mediaStream.removeTrack(track);\n      });\n      mediaStream.addTrack(mediaStreamTrack);\n\n      // NOTE(mpatwardhan): resetting `srcObject` here, causes flicker (JSDK-2641), but it lets us\n      // to sidestep the a chrome bug: https://bugs.chromium.org/p/chromium/issues/detail?id=1052353\n      //\n      el.srcObject = mediaStream;\n      el.autoplay = true;\n      el.playsInline = true;\n\n      if (!this._attachments.has(el)) {\n        this._attachments.add(el);\n      }\n\n      return el;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_selectElement',\n    value: function _selectElement(selector) {\n      var el = document.querySelector(selector);\n\n      if (!el) {\n        throw new Error('Selector matched no element: ' + selector);\n      }\n\n      return el;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_updateElementsMediaStreamTrack',\n    value: function _updateElementsMediaStreamTrack() {\n      var _this3 = this;\n\n      this._log.debug('Reattaching all elements to update mediaStreamTrack');\n      this._getAllAttachedElements().forEach(function (el) {\n        return _this3._attach(el);\n      });\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_createElement',\n    value: function _createElement() {\n      return typeof document !== 'undefined' ? document.createElement(this.kind) : null;\n    }\n  }, {\n    key: 'detach',\n    value: function detach(el) {\n      var els = void 0;\n\n      if (typeof el === 'string') {\n        els = [this._selectElement(el)];\n      } else if (!el) {\n        els = this._getAllAttachedElements();\n      } else {\n        els = [el];\n      }\n\n      this._log.debug('Attempting to detach from elements:', els);\n      this._detachElements(els);\n      return el ? els[0] : els;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_detachElements',\n    value: function _detachElements(elements) {\n      return elements.map(this._detachElement.bind(this));\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_detachElement',\n    value: function _detachElement(el) {\n      if (!this._attachments.has(el)) {\n        return el;\n      }\n\n      var mediaStream = el.srcObject;\n      if (mediaStream instanceof this._MediaStream) {\n        mediaStream.removeTrack(this.processedTrack || this.mediaStreamTrack);\n      }\n\n      this._attachments.delete(el);\n\n      if (this._shouldShimAttachedElements && this._elShims.has(el)) {\n        var shim = this._elShims.get(el);\n        shim.unShim();\n        this._elShims.delete(el);\n      }\n\n      return el;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_getAllAttachedElements',\n    value: function _getAllAttachedElements() {\n      var els = [];\n\n      this._attachments.forEach(function (el) {\n        els.push(el);\n      });\n\n      return els;\n    }\n  }]);\n\n  return MediaTrack;\n}(Track);\n\n/**\n * Play an HTMLMediaElement if it is paused and not backgrounded.\n * @private\n * @param {HTMLMediaElement} el\n * @param {Log} log\n * @returns {void}\n */\n\n\nfunction playIfPausedAndNotBackgrounded(el, log) {\n  var tag = el.tagName.toLowerCase();\n  log.warn('Unintentionally paused:', el);\n\n  // NOTE(mmalavalli): When the element is unintentionally paused, we wait one\n  // second for the \"onvisibilitychange\" event on the HTMLDocument to see if the\n  // app will be backgrounded. If not, then the element can be safely played.\n  Promise.race([waitForEvent(document, 'visibilitychange'), waitForSometime(1000)]).then(function () {\n    if (document.visibilityState === 'visible') {\n      // NOTE(mmalavalli): We play the inadvertently paused elements only after\n      // the LocalAudioTrack is unmuted to work around WebKit Bug 213853.\n      //\n      // Bug: https://bugs.webkit.org/show_bug.cgi?id=213853\n      //\n      localMediaRestartDeferreds.whenResolved('audio').then(function () {\n        log.info('Playing unintentionally paused <' + tag + '> element');\n        log.debug('Element:', el);\n        return el.play();\n      }).then(function () {\n        log.info('Successfully played unintentionally paused <' + tag + '> element');\n        log.debug('Element:', el);\n      }).catch(function (error) {\n        log.warn('Error while playing unintentionally paused <' + tag + '> element:', { error: error, el: el });\n      });\n    }\n  });\n}\n\n/**\n * Shim the pause() and play() methods of the given HTMLMediaElement so that\n * we can detect if it was paused unintentionally.\n * @param {HTMLMediaElement} el\n * @param {?function} [onUnintentionallyPaused=null]\n * @returns {{pausedIntentionally: function, unShim: function}}\n */\nfunction shimMediaElement(el) {\n  var onUnintentionallyPaused = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n  var origPause = el.pause;\n  var origPlay = el.play;\n\n  var _pausedIntentionally = false;\n\n  el.pause = function () {\n    _pausedIntentionally = true;\n    return origPause.call(el);\n  };\n\n  el.play = function () {\n    _pausedIntentionally = false;\n    return origPlay.call(el);\n  };\n\n  var onPause = onUnintentionallyPaused ? function () {\n    if (!_pausedIntentionally) {\n      onUnintentionallyPaused();\n    }\n  } : null;\n\n  if (onPause) {\n    el.addEventListener('pause', onPause);\n  }\n\n  return {\n    pausedIntentionally: function pausedIntentionally() {\n      return _pausedIntentionally;\n    },\n    unShim: function unShim() {\n      el.pause = origPause;\n      el.play = origPlay;\n      if (onPause) {\n        el.removeEventListener('pause', onPause);\n      }\n    }\n  };\n}\n\nmodule.exports = MediaTrack;"]},"metadata":{},"sourceType":"script"}